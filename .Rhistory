dSuperEduca$grade <- trimws(dSuperEduca$grade)
dSuperEduca$web <- trimws(dSuperEduca$web)
dSuperEduca$way <- trimws(dSuperEduca$way)
dSuperEduca$grade <- gsub("Total", "Total de Profissionais", dSuperEduca$grade)
dSuperEduca$web <- gsub("Total", "Todas as Redes", dSuperEduca$web)
# Step 5: fGroup
fSuperEducaGroup <- data.frame(group = unique(dSuperEduca$group), group_code = sequence(length(unique(dSuperEduca$group))))
# Step 6: fGrade
fSuperEducaGrade <- data.frame(grade = unique(dSuperEduca$grade), grade_code = sequence(length(unique(dSuperEduca$grade))))
# Step 7: fWeb
fSuperEducaWeb <- data.frame(web = unique(dSuperEduca$web), web_code = sequence(length(unique(dSuperEduca$web))))
# Step 8: fWay
fSuperEducaWay <- data.frame(way = unique(dSuperEduca$way), way_code = sequence(length(unique(dSuperEduca$way))))
# Step 9: Organize
dSuperEduca <- dSuperEduca[, c(1, 13:16, 3:12)]
} # Part 2: Separate Group, variable and web
{
# Step 1: Join all codes in dSuperEduca
dSuperEduca <- left_join(dSuperEduca, fCity, "city")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaGroup, "group")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaGrade, "grade")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaWay, "way")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaWeb, "web")
# Step 2: Change Columns
dSuperEduca <- dSuperEduca[, c(16, 18:21, 6:15)]
} # Part 3: Insert Codes
{
# Step 1: Gather dSuperEduca
dSuperEduca <- gather(dSuperEduca, key = "year", value = "result", c("2010":"2019"))
# Step 2: Join Population
dSuperEduca <- left_join(dSuperEduca, fPop, c("city_code", "year") )
dSuperEduca <- dSuperEduca[, c(1:7, 10)]
# Step 3: Add Group Code in Grade
fSuperEducaGrade <- left_join(fSuperEducaGrade, dSuperEduca[, c(2,3)], "grade_code")
# Step 4: Transform - into NA
dSuperEduca$result[dSuperEduca$result == "-"] <- NA
} # Part 4: Gather and Join Population
# Part 5: Export clean dSuperEduca
write.table(dSuperEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dSuperEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
write.csv(fSuperEducaGroup,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaGroup.csv")
write.csv(fSuperEducaWay,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaWay.csv")
write.csv(fSuperEducaGrade,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaGrade.csv")
write.csv(fSuperEducaWeb,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaWeb.csv")
View(fEducaVariable)
# Step 1: Variable Code
fEducaVariable <- dEduca %>%
select(variable, group)
View(fEducaVariable)
# Step 1: Variable Code
fEducaVariable <- dEduca %>%
select(group, variable)
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
dEduca$variable <- gsub("- Classes Exclusivas ", "", dEduca$variable)
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
dEduca <- dEduca[, c(1, 14:16, 3:13)]
dEduca <- dEduca[, c(1, 14:16, 3:13)]
{
# Step 1: import city database
fCity = read_delim("C:/Users/CepaTech/Documents/Profissional/SEPL/PowerBi 3/Banco de Dados/citiy/fcity2.csv",
";", escape_double = FALSE,
locale = locale(decimal_mark = ",",
grouping_mark = ".",
encoding = "UTF-8"),
trim_ws = TRUE)
# Step 2: Rename columns
colnames(fCity)[1] <- "city_code"
# Step 3: creating a list
temp = fCity
temp = as.vector(temp)
temp = as.vector(fCity$city_code)
# Step4: Export do db paste
write.csv(fCity, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fCity.csv")
# Step 5: Create lowercase city parameter to joins with IBGE Databases
fCity2 <- fCity
fCity2$city <- tolower(fCity2$city)
} # Part 1: Prepare City reference to forward joins
{
# Step 1: Import Database
fPop <- read_excel("~/Profissional/SEPL/PowerBi 3/Banco de Dados/population/pop_pr.xlsx")
# Step 2: Melt to create a year column
fPop <- melt(fPop)
colnames(fPop) <- c("city", "variable", "year", "population")
fPop$variable <- "population"
fPop$year <- as.character(fPop$year)
fPop <- left_join(fPop, fCity, "city")
# Step 3: Export database
write.csv(fPop, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fPop.csv")
} # Part 2: Prepare population to forward joins
{
# Step 1: Create fType
fType <- data.frame(type = c("absolute", "rate", "por mil"), type_code = c(1:3))
stand <- c("reais", "individuos", "dias",    "%", "por mil hab", "mil reais", "estabelecimentos", "")
fStandard <- data.frame(standard = stand,
standard_code = sequence(length(stand)))
write.csv(fType,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fType.csv")
write.csv(fStandard,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fStandard.csv")
} # Part 3: Create General use parameter
# Function to replace
str_pos_replace <- function(string, pattern, replacement, pos=1){
str_locate_all(string, pattern)[[1]][pos,, drop=FALSE] %>%
`str_sub<-`(string, ., value = replacement)
}
{
# Step 1: Import Wealth database
dPIB <- read_delim("~/Profissional/SEPL/PowerBi 3/Banco de Dados/wealth/PIB.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
colnames(dPIB)[1:2] <-  c("city", "variable")
# Step 2: Replace Variable names
dPIB$variable <- gsub(" *\\(.*?\\) *", "", dPIB$variable)
OldVariable <- unique(dPIB$variable)
NewVariable <- c("Produto Interno Bruto a Preços Correntes",
"Valor Adicionado Bruto Total",
"Valor Adicionado Bruto Agropecuaria",
"Valor Adicionado Bruto Industria",
"Valor Adicionado Bruto Comercio e Serviços",
"Produto Interno Bruto per Capita",
"Valor Adicionado Bruto Administraçao Publica",
"Imposto Recolhidos")
for (i in 1:8) {
dPIB$variable <- gsub(OldVariable[i], NewVariable[i], dPIB$variable)
}
# Step 3: Add Group Names
dPIB$group <- "PIB"
# Step 3: Add Standard
dPIB$standard <- "mil reais"
# Step 4: Add Type
dPIB$type <- "absolute"
} # Part 1: Import and Prepare Database
{
# Step 1: Gather years
dPIB <- gather(dPIB, key = "year", value = "result", c("2010":"2018"))
# Step 2: Create PIB Variable Codes
variable <- unique(dPIB$variable)
fWealthVariable <- as.data.frame(variable) %>%
mutate(variable_code = sequence(n()))
fWealthVariable <- fWealthVariable[, c(2,1)]
# Step 3: Create PIB Group Code
fWealthGroup <- data.frame(group_code = 1, group = "PIB")
# Step 4: Add city code
dPIB <- left_join(dPIB, fCity, "city")
# Step 5: Add Variable codes
dPIB <- left_join(dPIB, fWealthVariable, "variable")
# Step 6: Add Group code
dPIB <- left_join(dPIB, fWealthGroup, "group")
# Step 7: Add Standard code
dPIB <- left_join(dPIB, fStandard, "standard")
# Step 8: Add Type code
dPIB <- left_join(dPIB, fType, "type")
# Step 9: Rearrange database
dPIB <- dPIB[, c(8, 11, 10, 13, 12, 6, 7)]
# Step 10: Add population
dPIB <- left_join(dPIB, fPop, by = c("city_code", "year"))
# Step 11: Rearrange Database
dPIB <- dPIB[, c(1:7, 10)]
} # Part 2: Add codes
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
dEduca$variable <- gsub("- Classes Exclusivas ", "", dEduca$variable)
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable and web
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$web <- gsub("Total", "Todas as Redes", dEduca$web)
# Step 1: Variable Code
fEducaVariable <- dEduca %>%
select(group, variable)
View(fEducaVariable)
fEducaVariable = fEducaVariable[!duplicated(fEducaVariable), ]
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
# Step 1: Variable Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
fEducaVariable <- left_join(fEducaVariable, fEducaGroup, "group")
fEducaVariable <- fEducaVariable[, c(4,3,2)]
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
{
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, "variable")
# Step 4: Join Web
dEduca <- left_join(dEduca, fEducaWeb, "web")
# Step 5: Join Standard
dEduca$standard <- 5
# Step 6: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(16, 18:22, 5:15)]
} # Part 4: Join codes in dEduca
{
# Step 1: Gather
dEduca <- gather(dEduca, key = "year", value = "result", c("2010":"2020"))
# Step 2: Join Pop
dEduca <- left_join(dEduca, fPop, c("city_code", "year"))
# Step 3: Clean Database
dEduca <- dEduca[, -c(9,10,12)]
# Step 4: Transform - into NA
dEduca$result <- gsub("-", "", dEduca$result)
} # Part 5: Gather and Join Pop
# Part 3: Export clean dEduca
write.table(dEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
# Part 3: Export clean dEduca
write.table(dEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
write.csv(fEducaGroup,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fEducaGroup.csv")
write.csv(fEducaVariable,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fEducaVariable.csv")
write.csv(fEducaWeb,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fEducaWeb.csv")
View(dEduca)
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
dEduca$variable <- gsub("- Classes Exclusivas ", "", dEduca$variable)
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable and web
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
View(dEduca)
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$web <- gsub("Total", "Todas as Redes", dEduca$web)
View(dEduca)
{
# Step 1: Variable Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
# Step 2: Group Code
fEducaVariable <- dEduca %>%
select(group, variable)
fEducaVariable = fEducaVariable[!duplicated(fEducaVariable), ]
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
fEducaVariable <- left_join(fEducaVariable, fEducaGroup, "group")
fEducaVariable <- fEducaVariable[, c(4,3,2)]
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
} # Part 3: Create codes
{
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, c("variable", "group_code"))
# Step 4: Join Web
dEduca <- left_join(dEduca, fEducaWeb, "web")
# Step 5: Join Standard
dEduca$standard <- 5
# Step 6: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(16, 18:22, 5:15)]
} # Part 4: Join codes in dEduca
{
# Step 1: Gather
dEduca <- gather(dEduca, key = "year", value = "result", c("2010":"2020"))
# Step 2: Join Pop
dEduca <- left_join(dEduca, fPop, c("city_code", "year"))
# Step 3: Clean Database
dEduca <- dEduca[, -c(9,10,12)]
# Step 4: Transform - into NA
dEduca$result <- gsub("-", "", dEduca$result)
} # Part 5: Gather and Join Pop
# Part 3: Export clean dEduca
write.table(dEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
View(dEduca)
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
{
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
# Step 2: Determinate web
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
# Step 3: Determinate Group
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
mde <- c(" na Educação Superior", "Distância", " de Educação Superior", " a ", "Presencial")
for(i in 1:length(mde)){
dSuperEduca$group <- gsub(mde[i], "", dSuperEduca$group)
}
dSuperEduca$group <- trimws(dSuperEduca$group)
# Step 4: Determine Grade
dSuperEduca$grade <- case_when(dSuperEduca$grade == "" ~ "Total",
TRUE ~ as.character(dSuperEduca$grade))
dSuperEduca$grade <- trimws(dSuperEduca$grade)
dSuperEduca$web <- trimws(dSuperEduca$web)
dSuperEduca$way <- trimws(dSuperEduca$way)
dSuperEduca$grade <- gsub("Total", "Total de Profissionais", dSuperEduca$grade)
dSuperEduca$web <- gsub("Total", "Todas as Redes", dSuperEduca$web)
# Step 5: fGroup
fSuperEducaGroup <- data.frame(group = unique(dSuperEduca$group), group_code = sequence(length(unique(dSuperEduca$group))))
# Step 6: fGrade
fSuperEducaGrade <- data.frame(grade = unique(dSuperEduca$grade), grade_code = sequence(length(unique(dSuperEduca$grade))))
# Step 7: fWeb
fSuperEducaWeb <- data.frame(web = unique(dSuperEduca$web), web_code = sequence(length(unique(dSuperEduca$web))))
# Step 8: fWay
fSuperEducaWay <- data.frame(way = unique(dSuperEduca$way), way_code = sequence(length(unique(dSuperEduca$way))))
# Step 9: Organize
dSuperEduca <- dSuperEduca[, c(1, 13:16, 3:12)]
} # Part 2: Separate Group, variable and web
{
# Step 1: Join all codes in dSuperEduca
dSuperEduca <- left_join(dSuperEduca, fCity, "city")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaGroup, "group")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaGrade, "grade")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaWay, "way")
dSuperEduca <- left_join(dSuperEduca, fSuperEducaWeb, "web")
# Step 2: Change Columns
dSuperEduca <- dSuperEduca[, c(16, 18:21, 6:15)]
} # Part 3: Insert Codes
{
# Step 1: Gather dSuperEduca
dSuperEduca <- gather(dSuperEduca, key = "year", value = "result", c("2010":"2019"))
# Step 2: Join Population
dSuperEduca <- left_join(dSuperEduca, fPop, c("city_code", "year") )
dSuperEduca <- dSuperEduca[, c(1:7, 10)]
# Step 3: Add Group Code in Grade
fSuperEducaGrade <- left_join(fSuperEducaGrade, dSuperEduca[, c(2,3)], "grade_code")
# Step 4: Transform - into NA
dSuperEduca$result[dSuperEduca$result == "-"] <- NA
} # Part 4: Gather and Join Population
# Part 5: Export clean dSuperEduca
write.table(dSuperEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dSuperEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
write.csv(fSuperEducaGroup,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaGroup.csv")
write.csv(fSuperEducaWay,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaWay.csv")
write.csv(fSuperEducaGrade,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaGrade.csv")
write.csv(fSuperEducaWeb,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fSuperEducaWeb.csv")
View(dSuperEduca)
