comment = NA,
warning = FALSE,
error = FALSE,
message = FALSE,
tidy = TRUE)
# setting main root in personal drive
print(getwd())
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
dwdir = print(getwd()) # main personal project root
{
# Check if the packages that we need are installed
want = c("RCurl", "tidyverse", "readr", "zoo", "googledrive", "RCurl",
"gsheet", "stringr", "knitr", "data.table", "readxl", "qdapRegex")
have = want %in% rownames(installed.packages())
# Install the packages that we miss
if ( any(!have) ) { install.packages( want[!have] ) }
# Load the packages
junk <- lapply(want, library, character.only = T)
# Remove the objects we created
rm(have, want, junk)
} # Import packages
# setting principal roots (dw + first 3 database words + data type)
dwagriraw = paste0(dwdir, "/db/raw/agricultural")
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduEJA.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv")
for (i in 1:3){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
View(dEduca)
colnames(dEduca)[1:2] <- c("city", "variable")
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduEJA.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv")
for (i in 1:3){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
colnames(dEduca)[1:2] <- c("city", "variable")
# Step 1: Separate Group
dEcuda <- gsub("(.+?)(\\_.*)", "", dEduca$variable)
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduEJA.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv")
for (i in 1:3){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
{
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
View(dEduca)
}
}
dEduca <- dEduca[, c(1:13)]
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduEJA.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv")
for (i in 1:3){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
{
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
} # Part 2: Separate Group, variable and web
View(dEduca)
View(dEduca)
unique(dEduca$variable)
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv")
for (i in 1:3){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
unique(dEduca$variable)
dEduca$variable <- gsub("Matrículas na "|"Matrículas no ", "", dEduca$variable)
dEduca$variable <- gsub("Matrículas na ", "", dEduca$variable)
unique(dEduca$variable)
dEduca$variable <- gsub("Matrículas no ", "", dEduca$variable)
unique(dEduca$variable)
# Step 2: Separate Variable
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
View(dEduca)
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
unique(dEduca$variable)
View(dEduca)
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$variable <- gsub("Total", "Todas as Redes", dEduca$variable)
# Step 1: Group Code
fEducaGroup <- unique(dEduca$variable)
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
# Step 1: Group Code
fEducaGroup <- as.data.frame(unique(dEduca$variable))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
View(fEducaGroup)
# Step 1: Group Code
fEducaVariable <- as.data.frame( variable = unique(dEduca$variable))
# Step 1: Group Code
fEducaVariable <- adata.frame( variable = unique(dEduca$variable))
# Step 1: Group Code
fEducaVariable <- data.frame( variable = unique(dEduca$variable))
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
# Step 3: Web Code
fEducaWeb <- data.frame(group = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
{
# Step 1: import city database
fCity = read_delim("C:/Users/CepaTech/Documents/Profissional/SEPL/PowerBi 3/Banco de Dados/citiy/fcity2.csv",
";", escape_double = FALSE,
locale = locale(decimal_mark = ",",
grouping_mark = ".",
encoding = "UTF-8"),
trim_ws = TRUE)
# Step 2: Rename columns
colnames(fCity)[1] <- "city_code"
# Step 3: creating a list
temp = fCity
temp = as.vector(temp)
temp = as.vector(fCity$city_code)
# Step4: Export do db paste
write.csv(fCity, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fCity.csv")
# Step 5: Create lowercase city parameter to joins with IBGE Databases
fCity2 <- fCity
fCity2$city <- tolower(fCity2$city)
} # Part 1: Prepare City reference to forward joins
{
# Step 1: Import Database
fPop <- read_excel("~/Profissional/SEPL/PowerBi 3/Banco de Dados/population/pop_pr.xlsx")
# Step 2: Melt to create a year column
fPop <- melt(fPop)
colnames(fPop) <- c("city", "variable", "year", "population")
fPop$variable <- "population"
fPop$year <- as.character(fPop$year)
fPop <- left_join(fPop, fCity, "city")
# Step 3: Export database
write.csv(fPop, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fPop.csv")
} # Part 2: Prepare population to forward joins
{
# Step 1: Create fType
fType <- data.frame(type = c("absolute", "rate", "por mil"), type_code = c(1:3))
stand <- c("reais", "individuos", "dias",    "%", "por mil hab", "mil reais")
fStandard <- data.frame(standard = stand,
standard_code = sequence(length(stand)))
write.csv(fType,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fType.csv")
write.csv(fStandard,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fStandard.csv")
} # Part 3: Create General use parameter
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
View(fEducaGroup)
# Step 2: Group Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
View(fEducaGroup)
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, "variable")
# Step 4: Join Web
dEduc <- left_join(dEduca, fEducaWeb, "web")
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
# Step 4: Join Web
dEduc <- left_join(dEduca, fEducaWeb, "web")
View(fStandard)
View(fType)
# Step 5: Join Standard
dEduca$standard <- 5
# Step 5: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(15, 17:20, 5:14)]
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
{
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable and web
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$variable <- gsub("Total", "Todas as Redes", dEduca$variable)
} # Part 2: Separate Group, variable and web
{
# Step 1: Variable Code
fEducaVariable <- data.frame( variable = unique(dEduca$variable))
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
fEducaVariable <- fEducaVariable[, c(2,1)]
# Step 2: Group Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
} # Part 3: Create codes
{
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, "variable")
# Step 4: Join Web
dEduca <- left_join(dEduca, fEducaWeb, "web")
# Step 5: Join Standard
dEduca$standard <- 5
# Step 6: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(15, 17:20, 5:14)]
} # Part 4: Join codes in dEduca
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
{
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable and web
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$variable <- gsub("Total", "Todas as Redes", dEduca$variable)
} # Part 2: Separate Group, variable and web
{
# Step 1: Variable Code
fEducaVariable <- data.frame( variable = unique(dEduca$variable))
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
fEducaVariable <- fEducaVariable[, c(2,1)]
# Step 2: Group Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
} # Part 3: Create codes
{
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, "variable")
# Step 4: Join Web
dEduca <- left_join(dEduca, fEducaWeb, "web")
# Step 5: Join Standard
dEduca$standard <- 5
# Step 6: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(16, 17:20, 5:15)]
} # Part 4: Join codes in dEduca
# Step 1: Gather
dEduca <- gather(dEduca, key = "year", value = "result", c("2010":"2020"))
# Step 2: Join Pop
dEduca <- left_join(dEduca, fPop, c("city_code", "year"))
{
#Step 1:
dEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edubas.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
wd <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edumateja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduinfantil.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoccreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocmed.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudoceja.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\edudocexclusivo.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestcreche.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestmedio.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduestprofissa.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\education\\eduesteja.csv")
for (i in 1:11){
dEduca <- rbind(dEduca, read_delim(wd[i],
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 2: Rename Columns
colnames(dEduca)[1:2] <- c("city", "variable")
} # Part 1: Import database
{
# Step 1: Separate Group
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' '))))
dEduca <- dEduca[, c(1:14)]
mde <- c("Matrículas na ", "Matrículas no ", "Docentes na ", "Estabelecimentos de ")
for(i in 1:4){
dEduca$variable <- gsub(mde[i], "", dEduca$variable)
}
# Step 2: Separate Variable and web
dEduca <- cbind(dEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dEduca$variable),' - '))))
dEduca <- dEduca[, c(1, 14:16, 3:13)]
colnames(dEduca)[2:4] <- c("group", "variable", "web")
dEduca$variable <- gsub("Total", "Todas as Redes", dEduca$variable)
} # Part 2: Separate Group, variable and web
# Step 1: Variable Code
fEducaVariable <- data.frame( variable = unique(dEduca$variable))
fEducaVariable <- fEducaVariable[, c(2,1)]
# Step 2: Group Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
# Step 1: Variable Code
fEducaVariable <- data.frame( variable = unique(dEduca$variable))
fEducaVariable <- mutate(fEducaVariable, variable_code = sequence(n()))
fEducaVariable <- fEducaVariable[, c(2,1)]
Step 2: Group Code
# Step 2: Group Code
fEducaGroup <- data.frame(group = unique(dEduca$group))
fEducaGroup <- mutate(fEducaGroup, group_code = sequence(n()))
fEducaGroup <- fEducaGroup[, c(2,1)]
# Step 3: Web Code
fEducaWeb <- data.frame(web = unique(dEduca$web))
fEducaWeb <- mutate(fEducaWeb, web_code = sequence(n()))
fEducaWeb <- fEducaWeb[, c(2,1)]
# Step 1: Join City
dEduca <- left_join(dEduca, fCity, "city")
# Step 2: Join Group
dEduca <- left_join(dEduca, fEducaGroup, "group")
# Step 3: Join Variable
dEduca <- left_join(dEduca, fEducaVariable, "variable")
# Step 4: Join Web
dEduca <- left_join(dEduca, fEducaWeb, "web")
# Step 5: Join Standard
dEduca$standard <- 5
# Step 6: Join Type
dEduca$type <- 3
# Step 7: Rearrange data frame
dEduca <- dEduca[, c(16, 18:22, 5:15)]
# Step 1: Gather
dEduca <- gather(dEduca, key = "year", value = "result", c("2010":"2020"))
# Step 2: Join Pop
dEduca <- left_join(dEduca, fPop, c("city_code", "year"))
# Step 3: Clean Database
dEduca <- dEduca[, -c(9,10,12)]
# Part 3: Export clean dWealth
write.table(dEduca,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/clean/education/dEduca.csv",
sep = ";", dec = ",",
row.names = FALSE, col.names = TRUE,
na = "")
