# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
unique(dSuperEduca$grade)
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs, "", dSuperEduca$grade)
}
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
unique(dSuperEduca$group)
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$grade )
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$group)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
for(i in 1: length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
subs <- c("Distância.*", "\\Presencial.*")
for(i in 1: length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
subs <- c("*.Distância", "*.Presencial")
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("*.Distância", "*.Presencial")
for(i in 1: length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c(".*Distância", ".*Presencial")
for(i in 1: length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c(".*Distância", ".*Presencial")
for(i in 1: length(subs)){
dSuperEduca$way <- str_remove(dSuperEduca$way, subs[i])
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c(".*Distância", ".*Presencial")
for(j in 1:length(dSuperEduca$way)){
for(i in 1: length(subs)){
dSuperEduca$way[j] <- str_remove(dSuperEduca$way, subs[i])
}
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c(".*Distância", ".*Presencial")
for(j in 1:length(subs)){
for(i in 1:length(dSuperEduca$way)){
dSuperEduca$way[j] <- str_remove(dSuperEduca$way, subs[i])
}
}
for(i in i:length(dSuperEduca$way)){
dSuperEduca$way <- str_remove(dSuperEduca[i], ".*Distância")
}
dSuperEduca$way <- str_remove(dSuperEduca$way[i], ".*Distância")
for(i in i:length(dSuperEduca$way)){
dSuperEduca$way <- str_remove(dSuperEduca$way[i], ".*Distância")
}
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
unique(dSuperEduca$way)
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
View(dSuperEduca)
unique(dSuperEduca$group)
{
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
}
View(dSuperEduca)
{
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
# Step 2: Complement Variable
dSuperEduca$V1 <- gsub("Instituições", "Instituições de Ensino Superior", dSuperEduca$V1)
dSuperEduca$V1 <- gsub("Polos", "Polo de Apoio dos Cursos de Ensino Superior", dSuperEduca$V1)
mde <- c("Matrículas na Educação Superior", "Docentes na Educação Superior", "Instituições de Educação Superior", "Concluintes na Educação Superior", "Polos de Apoio dos Cursos de Educação Superior", " a ")
for(i in 1:length(mde)){
dSuperEduca$variable <- gsub(mde[i], "", dSuperEduca$variable)
}
# Step 2: Separate Variable and web
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' - '))))
dSuperEduca <- dSuperEduca[, c(1, 14:16, 3:13)]
colnames(dSuperEduca)[2:4] <- c("group", "variable", "web")
dSuperEduca$variable <- gsub("Total", "Todas as Redes", dSuperEduca$variable)
} # Part 2: Separate Group, variable and web
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
unique(dSuperEduca$group)
mde <- c(" na ", "Distância", "Educação Superior", " de ", " a ", "Presencial")
for(i in 1:length(mde)){
dSuperEduca$variable <- gsub(mde[i], "", dSuperEduca$variable)
}
for(i in 1:length(mde)){
dSuperEduca$group <- gsub(mde[i], "", dSuperEduca$group)
}
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
mde <- c(" na Educação Superior", "Distância", " de Educação Superior", " a ", "Presencial")
for(i in 1:length(mde)){
dSuperEduca$group <- gsub(mde[i], "", dSuperEduca$group)
}
dSuperEduca$grade <- case_when(dSuperEduca$grade == "" ~ "Total")
{
# Step 1: Import first Database
dSuperEduca <- read_delim("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSup.csv",
delim = ";", escape_double = FALSE, locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE)
# Step 2: Create import variable
vSupEdu <- c("C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupDis.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\MatSupPre.csv",
"C:\\Users\\CepaTech\\Documents\\Profissional\\SEPL\\PowerBi 3\\Banco de Dados\\superior education\\DocSupDot.csv")
# Step 3: Loop to import all in the same base
for ( i in 1: length(vSupEdu)){
dSuperEduca <- rbind(dSuperEduca,
read_delim(vSupEdu[i],
delim = ";", escape_double = FALSE, col_types = cols(`2010` = col_number(),
`2011` = col_number(), `2012` = col_number(),
`2013` = col_number(), `2014` = col_number(),
`2015` = col_number(), `2016` = col_number(),
`2017` = col_number(), `2018` = col_number(),
`2019` = col_number()), locale = locale(decimal_mark = ",",
grouping_mark = ".", encoding = "ISO-8859-1"),
trim_ws = TRUE))
}
# Step 4: Rename Columns
colnames(dSuperEduca)[1:2] <- c("city", "variable")
} # Part 1: Import Superior Education
# Step 1: Separate Group
for (i in 1:length(dSuperEduca$variable)){
dSuperEduca$variable[i] <- str_pos_replace(dSuperEduca$variable[i], " - ", " y ", pos = 1)
}
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$variable),' y '))))
dSuperEduca <- cbind(dSuperEduca,
as.data.frame(do.call("rbind", strsplit(as.character(dSuperEduca$V2),' - '))))
dSuperEduca <- dSuperEduca[, c(1:13, 15:16)]
colnames(dSuperEduca)[13:15] <- c("group", "grade", "web")
# Step 2: Determinate web
subs <- c("Total", "Rede Federal", "Rede Estadual", "Rede Municipal", "Rede Privada")
for(i in 1: length(subs)){
dSuperEduca$grade <- gsub(subs[i], "", dSuperEduca$grade)
}
# Step 3: Determinate Group
dSuperEduca <- dSuperEduca %>%
mutate(way = dSuperEduca$group )
subs <- c("Docentes na Educação Superior",
"Matrículas na Educação Superior a ",
"Concluintes na Educação Superior a ",
"Matrículas na Educação Superior ",
"Concluintes na Educação Superior ",
"Instituições de Educação Superior",
"Polos de Apoio dos Cursos de Educação Superior a ")
for(i in 1:length(subs)){
dSuperEduca$way <- gsub(subs[i], "", dSuperEduca$way)
}
mde <- c(" na Educação Superior", "Distância", " de Educação Superior", " a ", "Presencial")
for(i in 1:length(mde)){
dSuperEduca$group <- gsub(mde[i], "", dSuperEduca$group)
}
dSuperEduca$grade <- case_when(dSuperEduca$grade == "" ~ "Total",
FALSE)
dSuperEduca$grade <- case_when(dSuperEduca$grade == "" ~ "Total",
TRUE ~ as.character(dSuperEduca$grade))
unique(dSuperEduca$variable)
unique(dSuperEduca$grade)
# Step 5: fGroup
fSuperEducaGroup <- data.frame(group = unique(dSuperEduca$grade), group_code = sequence(length(unique(dSuperEduca$grade))))
View(fSuperEducaGroup)
# Step 5: fGroup
fSuperEducaGroup <- data.frame(group = unique(dSuperEduca$group), group_code = sequence(length(unique(dSuperEduca$group))))
View(fSuperEducaGroup)
dSuperEduca$group <- trimws(dSuperEduca)
dSuperEduca$group <- trimws(dSuperEduca$group)
# Step 5: fGroup
fSuperEducaGroup <- data.frame(group = unique(dSuperEduca$group), group_code = sequence(length(unique(dSuperEduca$group))))
dSuperEduca$grade <- trimws(dSuperEduca$grade)
dSuperEduca$web <- trimws(dSuperEduca$web)
dSuperEduca$way <- trimws(dSuperEduca$way)
# Step 6: fGrade
fSuperEducaGrade <- data.frame(grade = unique(dSuperEduca$grade), grade_code = sequence(length(unique(dSuperEduca$grade))))
View(fSuperEducaGrade)
# Step 6: fWeb
fSuperEducaWeb <- data.frame(web = unique(dSuperEduca$web), web_code = sequence(length(unique(dSuperEduca$web))))
# Step 8: fWay
fSuperEducaWay <- data.frame(way = unique(dSuperEduca$way), way_code = sequence(length(unique(dSuperEduca$way))))
View(fSuperEducaWay)
View(dSuperEduca)
# setting the chunck configuration
knitr::opts_chunk$set(echo = FALSE,
comment = NA,
warning = FALSE,
error = FALSE,
message = FALSE,
tidy = TRUE)
# setting main root in personal drive
print(getwd())
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
dwdir = print(getwd()) # main personal project root
{
# Check if the packages that we need are installed
want = c("RCurl", "tidyverse", "readr", "zoo", "googledrive", "RCurl",
"gsheet", "stringr", "knitr", "data.table", "readxl", "qdapRegex")
have = want %in% rownames(installed.packages())
# Install the packages that we miss
if ( any(!have) ) { install.packages( want[!have] ) }
# Load the packages
junk <- lapply(want, library, character.only = T)
# Remove the objects we created
rm(have, want, junk)
} # Import packages
# setting principal roots (dw + first 3 database words + data type)
dwagriraw = paste0(dwdir, "/db/raw/agricultural")
{
# Step 1: import city database
fCity = read_delim("C:/Users/CepaTech/Documents/Profissional/SEPL/PowerBi 3/Banco de Dados/citiy/fcity2.csv",
";", escape_double = FALSE,
locale = locale(decimal_mark = ",",
grouping_mark = ".",
encoding = "UTF-8"),
trim_ws = TRUE)
# Step 2: Rename columns
colnames(fCity)[1] <- "city_code"
# Step 3: creating a list
temp = fCity
temp = as.vector(temp)
temp = as.vector(fCity$city_code)
# Step4: Export do db paste
write.csv(fCity, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fCity.csv")
# Step 5: Create lowercase city parameter to joins with IBGE Databases
fCity2 <- fCity
fCity2$city <- tolower(fCity2$city)
} # Part 1: Prepare City reference to forward joins
{
# Step 1: Import Database
fPop <- read_excel("~/Profissional/SEPL/PowerBi 3/Banco de Dados/population/pop_pr.xlsx")
# Step 2: Melt to create a year column
fPop <- melt(fPop)
colnames(fPop) <- c("city", "variable", "year", "population")
fPop$variable <- "population"
fPop$year <- as.character(fPop$year)
fPop <- left_join(fPop, fCity, "city")
# Step 3: Export database
write.csv(fPop, "C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fPop.csv")
} # Part 2: Prepare population to forward joins
{
# Step 1: Create fType
fType <- data.frame(type = c("absolute", "rate", "por mil"), type_code = c(1:3))
stand <- c("reais", "individuos", "dias",    "%", "por mil hab", "mil reais")
fStandard <- data.frame(standard = stand,
standard_code = sequence(length(stand)))
write.csv(fType,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fType.csv")
write.csv(fStandard,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fStandard.csv")
} # Part 3: Create General use parameter
# Function to replace
str_pos_replace <- function(string, pattern, replacement, pos=1){
str_locate_all(string, pattern)[[1]][pos,, drop=FALSE] %>%
`str_sub<-`(string, ., value = replacement)
}
View(fStandard)
stand <- c("reais", "individuos", "dias",    "%", "por mil hab", "mil reais", "estabelecimentos")
fStandard <- data.frame(standard = stand,
standard_code = sequence(length(stand)))
write.csv(fType,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fType.csv")
write.csv(fStandard,
"C:/Users/CepaTech/Documents/GitHub/powerbi3.0/db/parameters/fStandard.csv")
# Step 9: Organize
dSuperEduca <- dSuperEduca[, c(1, 13:16, 3:12)]
